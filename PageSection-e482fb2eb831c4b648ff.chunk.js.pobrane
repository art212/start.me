(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{1093:function(t,e,i){},1561:function(t,e,i){"use strict";i(1093)},2036:function(t,e,i){"use strict";i.r(e);var s=i(4),n=i.n(s),o=i(15),a=i(182),d=i.n(a),r=i(3),c=i(5),l=i(499),g={name:"PageSection",components:{LightweightWidget:function(){return i.e(74).then(i.bind(null,2206))},draggable:d.a},props:{isEditable:r.a.bool.def(!1),section:r.a.object.def({}),pageData:r.a.object.def({}),isSorting:r.a.bool.def(!1),isEditing:r.a.bool.def(!1),isMobile:r.a.bool.def(!1)},data:function(){return{widgetFactory:null,expandedContextDropdown:null,lightweightWidgets:{},shouldReplaceData:!1,dndStarted:!1,intersections:[],observers:[],widgetToScroll:null,selectedWidgets:[],isProcessing:!1}},computed:n()({},Object(o.c)(["getCollapsedWidgets","isLoggedIn","getWidgetSortingState","getConfirmDialog"]),Object(o.c)("page",["getPagePublicId"]),{collapsedWidgets:function(){if(this.pageData&&this.pageData.public_id)return this.getCollapsedWidgets[this.pageData.public_id]},dndOptions:function(){return{group:"pageWidgets",disabled:!this.sortingEnabled,handle:".widget-header__dnd-handle",filter:".widget-header__settings",ghostClass:"widget_is-ghost",chosenClass:"widget_is-chosen",fallbackClass:"widget_is-dragged",fallbackTolerance:5,forceFallback:!0,delay:100,delayOnTouchOnly:!0}},columns:function(){if((!this.$utils.hasTouchScreen()||!this.isMobile)&&0!==this.pageData.column_count)return this.section.columns||[];if(this.$utils.hasTouchScreen()&&this.isMobile)return[{widgets:this.pageData.mobileWidgets}];var t=this.section.widgets||[];this.section.columns&&this.section.columns.forEach((function(e){e.widgets.forEach((function(e){return t.push(e)}))}));var e=this.determineOptimalColumnCount(t.length),i=Array(e).fill(null).map((function(){return{widgets:[]}}));return t.forEach((function(t,s){return i[s%e].widgets.push(t)})),i},pageId:function(){return this.pageData.id},sortingEnabled:function(){return this.isEditable},hasIntersections:function(){return!!window.IntersectionObserver},intersectedWidgets:function(){var t=this;return this.columns.map((function(e,i){return t.hasIntersections&&t.intersections[i]&&t.intersections[i].shouldObserve?e.widgets.slice(0,t.intersections[i].show):e.widgets}))},isFirefox:function(){return this.$featurizr&&"firefox"===this.$featurizr.browser}}),watch:{getWidgetSortingState:function(t){t||(this.unsetDataReplacing(),this.applyWidgetsOrder())},columns:{deep:!0,handler:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.getLightweightWidgets(t)}},pageData:{deep:!0,immediate:!0,handler:function(t){t&&t.public_id&&(this.collapsedWidgets||this.presetWidgetsCollapsedState())}},isProcessing:function(t){this.$eventBus.$emit(t?"start-loading":"end-loading")}},created:function(){this.$eventBus.$on("new-widget-added",this.scrollToWidget),this.$eventBus.$on("add-widget",this.disableObserving),this.$eventBus.$on("end-sorting",this.resetDraggedFlag),this.$eventBus.$on("scroll-to-widget",this.prepareScrollToWidget),this.$eventBus.$on("pagedata-updated",this.executeScrollToWidget),this.$eventBus.$on("organize-widgets",this.startWidgetsOrganizing),this.widgetFactory=new l.a,this.$utils.isMobileDevice()&&window.addEventListener("touchmove",this.handleTouchMove,{passive:!1})},beforeMount:function(){this.hasIntersections&&this.presetIntersections()},mounted:function(){!this.isMobile&&0===this.pageData.column_count&&this.sortingEnabled&&this.sortWidgets(),this.hasIntersections&&this.activateObservables()},beforeDestroy:function(){this.widgetFactory=null,this.$eventBus.$off("new-widget-added",this.scrollToWidget),this.$eventBus.$off("add-widget",this.disableObserving),this.$eventBus.$off("end-sorting",this.resetDraggedFlag),this.$eventBus.$off("scroll-to-widget",this.prepareScrollToWidget),this.$eventBus.$off("pagedata-updated",this.executeScrollToWidget),this.$eventBus.$off("organize-widgets",this.startWidgetsOrganizing),this.$utils.isMobileDevice()&&window.removeEventListener("touchmove",this.handleTouchMove,{passive:!1})},methods:n()({},Object(o.b)(["saveMobileWidgetsOrder","setWidgetCollapsed"]),Object(o.b)("page",["saveWidgetOrder","applyWidgetsOrder"]),{prepareScrollToWidget:function(t){this.widgetToScroll=t},executeScrollToWidget:function(){var t=this;this.$nextTick((function(){t.widgetToScroll&&t.scrollToWidget(t.widgetToScroll),t.widgetToScroll=null}))},setDraggedFlag:function(){this.dndStarted=!0,this.isFirefox||document.documentElement.classList.add("draggable-cursor")},resetDraggedFlag:function(){this.dndStarted=!1,this.isFirefox||document.documentElement.classList.remove("draggable-cursor")},presetIntersections:function(){this.intersections=this.columns.map((function(t){return t.widgets&&t.widgets.length>3?{show:3,shouldObserve:!0}:{show:t.widgets.length,shouldObserve:!1}}))},activateObservables:function(){this.columns.forEach(this.addObserver)},checkIntersections:function(t,e,i){var s=this;t.forEach((function(t){t.isIntersecting&&(s.addColumnContent(i),e.disconnect(),s.intersections[i].shouldObserve&&s.$utils.postpone((function(){s.addObserver(null,i)})))}))},addObserver:function(t,e){var i=this,s=this.$refs["observable_".concat(e)]&&this.$refs["observable_".concat(e)][0];if(s){var n=new IntersectionObserver((function(t,s){i.checkIntersections(t,s,e)}),{rootMargin:"0px 0px 500px 0px"});n.observe(s),this.observers.splice(e,1,n)}},disableObserving:function(){var t=this.intersections.map((function(t){return{show:0,shouldObserve:!1}}));this.intersections=t,this.observers.forEach((function(t){t&&t.disconnect()}))},addColumnContent:function(t){var e=this.intersections[t].show+3,i=!0;e>=this.columns[t].widgets.length&&(e=0,i=!1),this.intersections.splice(t,1,{show:e,shouldObserve:i})},setDataReplacing:function(){this.shouldReplaceData=!0},unsetDataReplacing:function(){this.shouldReplaceData=!1},getLightweightWidgets:function(){var t={};(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(e){(e.widgets||[]).forEach((function(e){var i=e.id,s=e.public_id,n=e.widget_type,o=e.title,a=e.icon,d=e.settings;t[s]={id:i,public_id:s,widget_type:n,title:o,icon:a,settings:d}}))})),this.lightweightWidgets=t},handleTouchMove:function(t){t.target&&t.target.classList&&t.target.classList.contains("widget-header__settings-list_alternate")&&(t.stopPropagation(),t.preventDefault())},presetWidgetsCollapsedState:function(){if(this.pageData&&this.pageData.public_id){this.setWidgetCollapsed({publicId:this.pageData.public_id,widgetId:[]})}},emitContentSidebar:function(t,e){this.isLoggedIn?(this.$eventBus.$emit("gtm-event","Navigation",{item:"AddWidgetsFromGrid"}),this.$eventBus.$emit("toggle-sidebar",{name:"content"},{columnIndex:t,forceWidgetsSidebar:e})):this.$eventBus.$emit("open-landing-popup",{isStatic:!0})},sortWidgets:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.resetDraggedFlag(),this.setDataReplacing(),this.$eventBus.$emit("end-edit-widget",null),this.$utils.hasTouchScreen()&&this.isMobile)return this.columns[0].widgets.forEach((function(t,e){t.index_mobile=e})),this.$emit("sortMobile"),this.isProcessing=!0,void this.saveMobileWidgetsOrder({widgets:this.columns[0].widgets,id:this.pageData.id}).finally((function(){t.isProcessing=!1}));var i=JSON.parse(JSON.stringify(e.columns||this.columns)),s=this.columns.length;if(this.pageData&&0===this.pageData.column_count){this.pageData.column_count=s;var n=JSON.parse(JSON.stringify(i));this.section.columns=n,this.$emit("setSection",{columns:n})}this.isProcessing=!0,this.saveWidgetOrder({columns:i,columnsCount:s,pageId:this.pageId,publicId:this.getPagePublicId(this.$route)}).catch(this.$logger.log).finally((function(){t.isProcessing=!1}))},determineOptimalColumnCount:function(t){var e=window.innerWidth,i=350;e>1100&&(i*=1.2),e-=i+20;var s=Math.max(1,Math.min(5,Math.round(e/(i+20)+1))),n=Math.max(2,Math.ceil(t/s)),o=s*n;return t<=3?Math.max(1,t):o-t>=n?Math.max(1,Math.min(s,Math.ceil(t/n))):s},scrollToWidget:function(t){var e=t.id,i=c.a.scrollToWidgetOptions,s=document.querySelector('[data-widget_id="'.concat(e,'"]'));if(s){var n=document.querySelector("html"),o=n.scrollTop,a=parseInt(n.style.marginTop)||0,d=s.getBoundingClientRect().top;(d=d+o-a)>i.offset&&(d-=i.offset),this.$nextTick((function(){"fixed"===n.style.position?n.style.marginTop="".concat(d,"px"):n.scrollTop=d}))}},emitEndSorting:function(t){if(!this.getConfirmDialog){var e=this.$utils.hasTouchScreen()||this.$utils.isHybridDevice()?"widget-header__move-handle":"widget-header";t&&t.target&&t.target.classList&&(t.target.classList.contains(e)||t.target.classList.contains("drop-item__title"))||this.$emit("endSorting")}},getContextItems:function(t){var e=this,i=this.$utils.defer();return[{id:"header",name:this.$t("add_widget"),isHead:!0,clickHandler:function(){}},{id:"bookmarks",name:this.$t("bookmarks"),svgIcon:"bookmark",isFull:!0,isModern:!0,clickHandler:function(){e.$eventBus.$emit("add-widget",{columnIndex:t,type:"urllist",deferred:i})},deferred:i},{id:"rss",name:this.$t("news_rss"),svgIcon:"rss",isFull:!0,isModern:!0,clickHandler:function(){e.$eventBus.$emit("toggle-sidebar",{name:"addFeed"},{id:c.a.rssWidgetDefaultId,columnIndex:t})}},{id:"notes",name:this.$t("notes"),svgIcon:"sticky-note",isFull:!0,isModern:!0,clickHandler:function(){e.$eventBus.$emit("add-widget",{columnIndex:t,type:"notes",deferred:i})},deferred:i},{id:"todo",name:this.$t("widgets.todo.new_widget_title"),svgIcon:"list",isFull:!0,isModern:!0,clickHandler:function(){e.$eventBus.$emit("add-widget",{columnIndex:t,type:"todo",deferred:i})},deferred:i},{id:"embed",name:this.$t("embed_webpage"),svgIcon:"code",isFull:!0,isModern:!0,clickHandler:function(){e.$eventBus.$emit("add-widget",{columnIndex:t,type:"iframe",deferred:i})},deferred:i},{id:"add_content",name:this.$t("browse_all_widgets"),isFull:!0,isBlue:!0,clickHandler:function(){e.openWidgetsSidebar(t)}}]},openWidgetsSidebar:function(t){this.emitContentSidebar(t,!0)},handlePlus:function(t,e){var i=this;if(this.isLoggedIn&&"touch"!==this.$featurizr.deviceType){this.expandedContextDropdown=this.expandedContextDropdown===t?null:t;var s,n="plus_".concat(t),o=this.getContextItems(t),a=e.pageX,d=e.pageY;if(this.$refs[n]&&this.$refs[n].length){var r=this.$refs[n][0].getBoundingClientRect(),c=r.top,l=r.left,g=r.width;a=l,d=c+document.documentElement.scrollTop,s=g}var u=53*o.length;this.$eventBus.$emit("toggle-contextmenu",{items:o,clickHandler:function(){},positionX:a,positionY:d,positionToRightOfX:!0,dropdownWidth:s,dropdownHeight:u,event:e,closeHandler:function(){i.expandedContextDropdown=null},forceOpen:!0})}else this.emitContentSidebar()},startWidgetsOrganizing:function(){this.setDataReplacing(),this.$eventBus.$emit("start-sorting")},initDnDStart:function(){this.setDraggedFlag(),this.$eventBus.$emit("start-sorting")}})},u=g,h=(i(1561),i(8)),p=Object(h.a)(u,(function(){var t=this,e=t._self._c;return e("section",{class:["page-section",`page-section_column${t.columns.length}`,{"page-section_mobile":t.isMobile}]},t._l(t.columns,(function(i,s){return e("section",{key:s,class:["page-section__column",`page-section__column_index_${s+1}`,{"page-section__column_spaced_bottom":t.$parent.isBannerAdVisible,"page-section__column_last":s===t.columns.length-1}]},[e("draggable",t._b({directives:[{name:"click-outside",rawName:"v-click-outside",value:t.emitEndSorting,expression:"emitEndSorting"}],key:`draggable_${s}`,staticClass:"page-section__draggable",class:{"page-section__draggable_active":t.dndStarted},on:{start:t.initDnDStart,end:t.sortWidgets},model:{value:i.widgets,callback:function(e){t.$set(i,"widgets",e)},expression:"column.widgets"}},"draggable",t.dndOptions,!1),t._l(t.intersectedWidgets[s],(function(i){return e("div",{key:t.pageData&&"discover"===t.pageData.type?`${i.id}-${i.section}`:i.id,staticClass:"page-section__widget",attrs:{"data-widget_id":i.id}},[t.getWidgetSortingState&&t.lightweightWidgets[i.public_id]&&t.shouldReplaceData?e("LightweightWidget",{attrs:{"widget-data":i,"page-data":t.pageData,"is-editable":t.isEditable,"is-collapsed":t.collapsedWidgets&&t.collapsedWidgets.includes(i.id)}}):e(t.widgetFactory.build(i.widget_type),{tag:"component",attrs:{"widget-data":i,"dnd-started":t.dndStarted,"page-data":t.pageData,"is-editable":t.isEditable,"is-collapsed":t.collapsedWidgets&&t.collapsedWidgets.includes(i.id)}})],1)})),0),t._v(" "),!t.dndStarted&&(t.isEditable||t.pageData.is_default&&!t.isLoggedIn)?e("transition",{attrs:{name:"fade"}},[e("div",{staticClass:"page-section__plus-container"},[e("div",{ref:`plus_${s}`,refInFor:!0,class:["page-section__plus",{"page-section__plus_hidden":t.isSorting}]},[e("a",{staticClass:"page-section__button",on:{click:function(e){return t.handlePlus(s,e)}}},[e("span",{staticClass:"page-section__button-sign"},[t._v("+")]),t._v(" "),e("span",{staticClass:"page-section__button-text"},[t._v(t._s(t.$t("add_widget")))])])])])]):t._e(),t._v(" "),t.intersections[s]&&t.intersections[s].shouldObserve?e("span",{ref:`observable_${s}`,refInFor:!0,staticClass:"page-section__observable"}):t._e()],1)})),0)}),[],!1,null,null,null);e.default=p.exports}}]);