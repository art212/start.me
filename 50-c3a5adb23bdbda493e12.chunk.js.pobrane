(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{1107:function(t,e,i){},1577:function(t,e,i){"use strict";i(1107)},2051:function(t,e,i){"use strict";i.r(e);var s=i(4),n=i.n(s),o=i(182),a=i.n(o),r=i(15),d=i(493),l=i(492),c=i(735),u={auto:0,small:1,medium:2,large:3},g={name:"NotesWidget",components:{BaseWidget:d.a,SidebarButton:function(){return i.e(264).then(i.bind(null,707))},CustomTab:function(){return i.e(46).then(i.bind(null,1361))},FolderTitleChanger:function(){return i.e(10).then(i.bind(null,2210))},SvgStrokeIcon:function(){return Promise.resolve().then(i.bind(null,27))},draggable:a.a,WysiwygEditor:function(){return Promise.all([i.e(354),i.e(270)]).then(i.bind(null,2010))}},mixins:[l.a],data:function(){return{activeNoteId:this.widgetData.items&&this.widgetData.items.notes&&this.widgetData.items.notes.length?this.widgetData.items.notes[0].id:0,notes:"",test:0,icon:"",defaultIcon:"sticky-note",help_article:"201208671-Notes",defaultBackgroundColor:{r:255,g:255,b:221},preview:{title_phrase:"new_notes_widget_title",t:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras ut vulputate libero. Proin bibendum luctus velit at luctus. Suspendisse malesuada."},caretPosition:null,mdFactory:null,editedNote:null,contextNote:null,isNoteAdding:!1,isMarkdown:!0,isMarkdownMode:!1,showMarkdownToggle:!0}},computed:n()({},Object(r.c)(["isLoggedIn","getUserPreferences"]),{activeNoteIndex:function(){var t=this;if(!this.widgetData.items||!this.widgetData.items.notes||!this.widgetData.items.notes.length||!this.activeNoteId)return-1;var e=-1;return this.widgetData.items.notes.some((function(i,s){return t.activeNoteId===i.id&&(e=s,!0)})),e},isTextChanged:function(){return this.isEditingState&&this.activeNote&&this.activeNote.text!==this.notes},notesList:{get:function(){return this.widgetData.items&&this.widgetData.items.notes},set:function(t){var e=t.map((function(t,e){return n()({},t,{index:e})}));this.widgetData.items={notes:e},this.saveNotesOrder({widgetId:this.widgetData.id,notesList:e})}},activeNote:function(){var t=this;return this.widgetData.items&&this.widgetData.items.notes&&this.widgetData.items.notes.length&&this.activeNoteId&&this.widgetData.items.notes.find((function(e){return e.id===t.activeNoteId}))||null},settingsToCopy:function(){return this.widgetData.settings?{s:this.widgetData.settings.s}:null},processedText:function(){if(!this.activeNote&&!this.widgetData.isPreviewMode)return"";var t=this.widgetData.isPreviewMode?this.preview.t:this.activeNote.text||"",e=!(!this.getUserPreferences||!this.getUserPreferences.open_links_in_new_window);return this.mdFactory.markdown({target:e?"_blank":"_top"})(t)},height:function(){var t={1:7,2:15,3:30};return t[this.settings.s||0]?21*t[this.settings.s]:null},inIframe:function(){try{return window.self!==window.top}catch(t){return!0}},layeredContextMenuConfig:function(){var t=this,e={title:this.$t("general")},i=this.getWidgetActionsField();i.items.unshift({id:"add_note",label:this.$t("add_note"),clickHandler:function(){t.processNoteAdding(),t.closeContextSidebar()}});var s=i.items.find((function(t){return"edit"===t.id}));s&&(s.label=this.$t("edit_notes")),this.isEditingState&&this.$utils.hasAccessToClipboard()&&i.items.splice(1,0,{id:"paste",label:this.$t("paste"),clickHandler:function(){t.pasteNote(),t.closeContextSidebar()}});var n=this.getLayeredContextMenuConfig(i);if(this.checkContext(this.contextMenuIds.DISPLAY_ID)){var o=Object.entries(u).map((function(e){var i="size.".concat(e[0]);return"auto"===e[0]&&(i="auto"),{id:e[0],value:e[1],label:t.$t(i)}})),a=[[{label:this.$t("height"),type:"oneRowRadio",vmodel:this.settings,vmodelField:"s",options:o,inputChangeHandler:function(){t.saveSettings()}}]];if(this.settingsToCopy){var r={label:"",type:"actionsList",items:[{label:this.$t("apply_to_all_widgets"),isBlue:!0,isSeparated:!0,isRegular:!0,clickHandler:function(){t.$$distributeWidgetSettings(),t.closeContextSidebar()}}]};a[0].push(r)}n.push({headerTitle:this.$t("display_settings"),hasArrow:!0,listenHeader:!0,hasClose:!0,headerClickHandler:function(){t.removeContext(t.contextMenuIds.DISPLAY_ID)},tabs:[e],fields:a,activeTab:0})}return n},noteMenuForm:function(){var t=this;if(!this.contextNote)return[];var e=n()({},this.contextNote),i=e.editTitle,s=[],o={title:this.$t("general")},a=[{label:"",type:"actionsList",items:[{label:this.$t("copy_note"),hasChevron:!0,clickHandler:function(){s.push({headerTitle:t.$t("copy_note"),hasArrow:!0,listenHeader:!0,hasClose:!0,headerClickHandler:function(){s.pop()},tabs:[],fields:[],component:{name:"MoveTabSidebar",props:{item:e,sourceWidget:t.widgetData,currentPagePublicId:t.getPagePublicId(t.$route),isDuplicating:!0,isEmbed:!0}},activeTab:0})}},{label:this.$t("move_note"),hasChevron:!0,clickHandler:function(){t.closeWithoutSaving(),t.closeEditNoteTitle();var i=t.$utils.defer();t.bindDeferredListener(i,e),s.push({headerTitle:t.$t("move_note"),hasArrow:!0,listenHeader:!0,hasClose:!0,headerClickHandler:function(){s.pop()},tabs:[],fields:[],component:{name:"MoveTabSidebar",props:{deferred:i,item:e,sourceWidget:t.widgetData,currentPagePublicId:t.getPagePublicId(t.$route),isDuplicating:!1,isEmbed:!0}},activeTab:0})}},{label:this.$t("delete_note"),isRed:!0,isSeparated:!0,clickHandler:function(){t.closeWithoutSaving(),t.closeEditNoteTitle(),e.text?t.$eventBus.$emit("toggle-confirm",{title:"",message:t.$t("confirm_delete_note"),showAttention:!0,safetyCheckLabel:t.$t("attention_delete_note"),confirmHandler:function(){t.processDeleteNote(e),t.clearContextNote()},confirmButtonLabel:t.$t("delete_note"),confirmButtonType:"warn",cancelButtonLabel:t.$t("cancel"),cancelHandler:function(){}}):(t.processDeleteNote(e),t.clearContextNote()),t.$eventBus.$emit("close-sidebars")}}]}];i&&a[0].items.unshift({label:this.$t("edit_note_title"),clickHandler:function(){t.$eventBus.$emit("close-sidebars"),t.openEditNoteTitle(e),t.clearContextNote()}});var r={headerTitle:this.$t("note_menu"),hasArrow:!1,listenHeader:!1,hasClose:!0,headerClickHandler:function(){},tabs:[o],activeTab:0,fields:[a]};return s.push(r),s},isNoteTabbed:function(){return!!this.notesList&&this.notesList.length>1}}),watch:{"settings.s":{handler:function(t){var e=this;this.isEditingState&&this.$nextTick((function(){return e.$refs.textarea.$el.focus()}))}},isEditingState:function(t){this.activeNote&&(this.notes=t&&this.activeNote.text||"")},activeNoteId:function(){var t=this;this.$nextTick((function(){t.notes=t.activeNote.text||""}))}},created:function(){this.$eventBus.$on("keypress-escape",this.closeByEsc),this.mdFactory=new c.default},beforeDestroy:function(){this.$eventBus.$off("keypress-escape",this.closeByEsc)},methods:n()({},Object(r.b)(["addNewNote","saveNote","saveNotesOrder","deleteNote"]),{bindDeferredListener:function(t,e){var i=this;t.promise.then((function(){i.$nextTick((function(){i.activeNoteId===e.id&&i.activateNote(i.widgetData.items.notes[0])}))}))},closeByEsc:function(){this.saveAndClose({isClosingForced:!0})},saveChanges:function(){this.processNoteSaving()},beforeSaveHook:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1]||(this.settings.t=this.notes)},settingsDefaults:function(){return{s:0}},leaveEditMode:function(){this.isEditingState&&this.toggleEditing(this.widgetData.id)},processNoteAdding:function(){var t=this;this.isNoteAdding=!0,this.addNewNote({publicId:this.getPagePublicId(this.$route),widgetId:this.widgetData.id}).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.note&&t.activateNote(e.note),t.isNoteAdding=!1})).catch((function(e){t.$logger.log(e),t.isNoteAdding=!1}))},processNoteSaving:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(arguments.length>1&&void 0!==arguments[1]&&arguments[1]||this.activeNote&&this.activeNote.text!==this.notes)&&(this.activeNote.text=this.notes,this.activeNoteIndex>=0&&this.widgetData.items.notes.splice(this.activeNoteIndex,1,n()({},this.activeNote)),this.saveNote({publicId:this.getPagePublicId(this.$route),widgetId:this.widgetData.id,note:this.activeNote,skipReplacing:t}))},isEmpty:function(){return!1},isEmptyLiveCopy:function(){return this.widgetData&&this.widgetData.is_live_copy&&this.widgetData.items&&this.widgetData.items.access_denied},pasteNote:function(){var t=this;this.$utils.readFromClipboard().then((function(e){if(null!==t.caretPosition){var i=t.caretPosition,s=i.start,n=i.end;t.notes="".concat(t.notes.substring(0,s)).concat(e).concat(t.notes.substring(n)),t.caretPosition=null,t.$forceUpdate()}else t.notes="".concat(t.notes).concat(e)})).catch(this.$logger.log)},saveCaretPosition:function(){this.caretPosition=this.getCaretPosition()},getCaretPosition:function(){if(!this.$refs.textarea)return null;var t=this.$refs.textarea.$el;if(document.selection){var e=document.selection.createRange(),i=e.text.length;e.moveStart("character",-t.value.length);var s=e.text.length-i;return{start:s,end:s+i}}return t.selectionStart||0===t.selectionStart?{start:t.selectionStart,end:t.selectionEnd}:{start:0,end:0}},closeWithoutSaving:function(){this.leaveEditMode()},saveAndClose:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isTextChanged||!t.isClosingForced?(this.isTextChanged||this.isTitleChanged)&&(this.leaveEditMode(),this.processNoteSaving()):this.closeWithoutSaving()},enableEditingState:function(){this.isEditable&&(this.isEditingState=!0)},setEditingStateActive:function(){this.isEditable&&!this.isLiveCopy&&this.toggleEditing(this.widgetData.id,{skipHeaderSelection:!0})},activateNote:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.activeNoteId!==e.id&&(this.isTextChanged&&this.processNoteSaving(),this.$nextTick((function(){t.activeNoteId=e.id||0})))},setNoteTitle:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.title){var i=e.title.trim(),s=this.activeNote;this.activeNote.id!==this.editedNote.id&&(s=this.notesList.find((function(e){return e.id===t.editedNote.id}))),s&&i&&i!==s.title&&(s.title=i,this.saveNote({publicId:this.getPagePublicId(this.$route),widgetId:this.widgetData.id,note:s})),this.closeEditNoteTitle()}else this.closeEditNoteTitle()},processDeleteNote:function(t){var e=this.notesList.find((function(e){return e.id===t.id}));e&&this.notesList.length>1?(this.deleteNote({publicId:this.getPagePublicId(this.$route),widgetId:this.widgetData.id,noteId:e.id}),this.widgetData.items.notes=this.widgetData.items.notes.filter((function(t){return t.id!==e.id})),this.activeNoteId===e.id&&(this.activeNoteId=this.widgetData.items.notes[0]?this.widgetData.items.notes[0].id:0)):e&&(e.title=this.$t("note"),e.text="",e.index=0,this.widgetData.items.notes=[n()({},e)],this.saveNote({publicId:this.getPagePublicId(this.$route),widgetId:this.widgetData.id,note:e}))},toggleNoteContextMenu:function(t){var e=this,i=t.event,s=t.note,o=t.fromClick;if((!i||!i.shiftKey&&!i.ctrlKey)&&this.isLoggedIn&&this.isEditable&&!this.isLiveCopy){var a,r;i&&(i.preventDefault(),i.stopPropagation(),a=i.pageX,r=i.pageY-window.pageYOffset),o||(s.editTitle=!0),this.contextNote=s;var d={positionX:a,positionY:r,positionToLeftOfX:!1,event:i,formsArray:this.noteMenuForm,closeHandler:function(){e.clearContextNote()}};this.$eventBus.$emit("toggle-sidebar",{name:"layeredContextMenu"},n()({},d,{page:this.pageData}))}},clearContextNote:function(){this.contextNote=null},openEditNoteTitle:function(t){this.isLiveCopy||(this.editedNote=t)},closeEditNoteTitle:function(){this.editedNote=null},updateNote:function(t){this.notes=t},toggleMarkdownMode:function(){this.isMarkdownMode=!this.isMarkdownMode},preventLayeredContextMenu:function(){return!1}})},h=g,p=(i(1577),i(8)),v=Object(p.a)(h,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"notes-widget-wrapper",class:{"notes-widget-wrapper_theme_dark":t.isDark}},[e("BaseWidget",{attrs:{"is-marginless":""}},[t.notesList&&t.notesList.length>1?e("div",{staticClass:"notes-widget-wrapper__tabs",class:{"notes-widget-wrapper__tabs_shaded":!!t.editedNote},attrs:{slot:"tabs"},slot:"tabs"},[t.editedNote?e("div",{staticClass:"notes-widget-wrapper__tabs-changer"},[e("div",{staticClass:"notes-widget-wrapper__tabs-changer-wrapper"},[e("FolderTitleChanger",{staticClass:"notes-widget-wrapper__tabs-changer-component",attrs:{"folder-name":t.editedNote.title,"is-dark":t.isDark,"widget-id":t.widgetData.id},on:{save:t.setNoteTitle}}),t._v(" "),e("a",{staticClass:"notes-widget-wrapper__button",on:{click:function(e){return e.stopPropagation(),t.toggleNoteContextMenu({event:e,note:t.editedNote,fromClick:!0})}}},[e("SvgStrokeIcon",{staticClass:"notes-widget-wrapper__button-icon",attrs:{icon:"more-horizontal",options:{size:16}}})],1)],1)]):t._e(),t._v(" "),e("draggable",t._b({key:`darggable_notes_widget_${t.widgetData.id}`,staticClass:"notes-widget-wrapper__tabs-list",class:{"notes-widget-wrapper__tabs-list_hidden":!!t.editedNote},attrs:{tag:"ul"},model:{value:t.notesList,callback:function(e){t.notesList=e},expression:"notesList"}},"draggable",{handle:".notes-widget-wrapper__tab_draggable",animation:200,disabled:!t.isEditable||t.isLiveCopy,touchStartThreshold:3,delay:t.$utils.isIPad()?0:300,delayOnTouchOnly:!0},!1),[t._l(t.notesList,(function(i){return e("li",{key:i.id,staticClass:"notes-widget-wrapper__tab notes-widget-wrapper__tab_draggable",class:{"notes-widget-wrapper__tab_active":t.activeNote&&i.id===t.activeNote.id}},[e("CustomTab",{attrs:{tab:i,"widget-id":t.widgetData.id,"is-editing-widget":t.isEditingState,"is-editable":t.isEditable,"is-active":t.activeNote&&i.id===t.activeNote.id},on:{editTab:function(e){return t.openEditNoteTitle(i)}},nativeOn:{click:function(e){return t.activateNote(i)},dblclick:function(e){return t.openEditNoteTitle(i)},contextmenu:function(e){return t.toggleNoteContextMenu({event:e,note:i})}}})],1)})),t._v(" "),t.isEditable&&!t.isLiveCopy?e("li",{staticClass:"notes-widget-wrapper__tab notes-widget-wrapper__tab_fixed"},[e("a",{staticClass:"notes-widget-wrapper__tab-creator notes-widget-wrapper__tab-creator_small",on:{click:t.processNoteAdding}},[t.isNoteAdding?e("SvgStrokeIcon",{staticClass:"notes-widget-wrapper__tab-name notes-widget-wrapper__tab-name_spinning",attrs:{icon:"loader"}}):e("span",{staticClass:"notes-widget-wrapper__tab-name"},[t._v("+")])],1)]):t._e()],2)],1):t._e(),t._v(" "),e("div",{staticClass:"notes-widget-wrapper__body",on:{contextmenu:function(e){return e.stopPropagation(),t.preventLayeredContextMenu.apply(null,arguments)}}},[!t.isEditable||!t.isEditingState&&t.activeNote&&t.activeNote.text?e("div",{staticClass:"notes-widget",class:[`height-${t.settings.s||0}`,{"notes-widget_theme_dark":t.isDark,"notes-widget_spaced":t.notesList&&t.notesList.length>1}]},[e("span",{ref:"container",staticClass:"notes-widget__result",domProps:{innerHTML:t._s(t.processedText)},on:{dblclick:function(e){return e.stopPropagation(),e.preventDefault(),t.setEditingStateActive.apply(null,arguments)}}})]):t.isLiveCopy?t._e():e("div",{staticClass:"notes-widget",class:{"notes-widget_spaced":t.notesList&&t.notesList.length>1}},[t.isEditingState?[t.isMarkdownMode?e("textarea-autosize",{ref:"textarea",staticClass:"notes-widget__textarea",class:{"notes-widget__textarea_empty":!t.isEditingState&&!t.notes.length},style:t.backgroundColor.a<1?{}:{backgroundColor:`rgb(${t.backgroundColor.r}, ${t.backgroundColor.g}, ${t.backgroundColor.b})`},attrs:{rows:"1","max-height":t.height},on:{paste:function(t){t.stopPropagation()}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.ctrlKey?t.saveAndClose.apply(null,arguments):null},dblclick:function(t){t.stopPropagation(),t.preventDefault()},paste:function(t){t.stopPropagation()},mouseout:function(e){return t.saveCaretPosition.apply(null,arguments)},mouseup:function(e){return t.saveCaretPosition.apply(null,arguments)},click:function(e){return e.stopPropagation(),t.enableEditingState.apply(null,arguments)}},model:{value:t.notes,callback:function(e){t.notes=e},expression:"notes"}}):e("WysiwygEditor",{ref:"wysiwygEditor",class:{"notes-widget_spaced":t.notesList&&t.notesList.length>1},attrs:{text:t.notes,tabbed:t.isNoteTabbed},on:{paste:function(t){t.stopPropagation()},update:t.updateNote},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.ctrlKey?t.saveAndClose.apply(null,arguments):null},dblclick:function(t){t.stopPropagation(),t.preventDefault()},paste:function(t){t.stopPropagation()},mouseout:function(e){return t.saveCaretPosition.apply(null,arguments)},mouseup:function(e){return t.saveCaretPosition.apply(null,arguments)},click:function(e){return e.stopPropagation(),t.enableEditingState.apply(null,arguments)}}})]:t._e(),t._v(" "),!t.activeNote||t.activeNote.text||t.notes?t._e():e("div",{staticClass:"notes-widget__placeholder",class:{"notes-widget__placeholder_lowered":t.isMarkdownMode}},[t._v(t._s(t.$t("start_writing")))])],2),t._v(" "),t.isEditingState?e("div",{staticClass:"notes-widget__controls"},[e("div",{staticClass:"notes-widget__buttons"},[e("a",{staticClass:"notes-widget__button notes-widget__button_default",class:{"notes-widget__button_disabled":!t.isTextChanged&&!t.isTitleChanged},on:{click:function(e){return e.stopPropagation(),t.saveAndClose.apply(null,arguments)}}},[t._v(t._s(t.$t("save")))]),t._v(" "),e("a",{staticClass:"notes-widget__button",on:{click:function(e){return e.stopPropagation(),t.closeWithoutSaving.apply(null,arguments)}}},[t._v(t._s(t.$t("cancel")))])])]):t._e()])])],1)}),[],!1,null,null,null);e.default=v.exports}}]);